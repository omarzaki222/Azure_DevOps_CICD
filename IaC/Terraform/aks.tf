module "aks" {
  source                                   = "./Modules/aks/"
  aks_name                                 = local.aks_name
  location                                 = local.location
  resource_group_name                      = local.resourceGroupName
  dns_prefix                               = local.dns_prefix
  private_cluster_enabled                  = local.private_cluster_enabled
  automatic_channel_upgrade                = local.automatic_channel_upgrade
  sku_tier                                 = local.aks_sku_tier
  default_node_pool_name                   = local.default_node_pool_name
  default_node_pool_vm_size                = local.default_node_pool_vm_size
  default_node_pool_subnet_name            = local.default_node_pool_subnet_name
  vnet_subnet_id                           = module.vnet.aks_subnet_id
  default_node_pool_availability_zones     = local.default_node_pool_availability_zones
  default_node_pool_node_labels            = local.default_node_pool_node_labels
  default_node_pool_enable_auto_scaling    = local.default_node_pool_enable_auto_scaling
  default_node_pool_enable_host_encryption = local.default_node_pool_enable_host_encryption
  default_node_pool_enable_node_public_ip  = local.default_node_pool_enable_node_public_ip
  default_node_pool_max_pods               = local.default_node_pool_max_pods
  default_node_pool_max_count              = local.default_node_pool_max_count
  default_node_pool_min_count              = local.default_node_pool_min_count
  default_node_pool_node_count             = local.default_node_pool_node_count
  default_node_pool_os_disk_type           = local.default_node_pool_os_disk_type
  identity_type                            = local.identity_type
  key_vault_secrets_provider               = local.key_vault_secrets_provider
  secret_rotation_enabled                  = local.secret_rotation_enabled
  network_plugin                           = local.network_plugin
  role_based_access_control_enabled        = local.role_based_access_control_enabled
  azure_rbac_enabled                       = local.azure_rbac_enabled
  admin_username                           = local.admin_username
  workload_identity_enabled                = local.workload_identity_enabled
  local_account_disabled                   = local.local_account_disabled
  oidc_issuer_enabled                      = local.oidc_issuer_enabled
  image_cleaner_enabled                    = local.image_cleaner_enabled
  azure_policy_enabled                     = local.azure_policy_enabled
  http_application_routing_enabled         = local.http_application_routing_enabled
  loadbalancerSku                          = local.loadbalancerSku
  ingress_application_gateway_enabled      = local.ingress_application_gateway_enabled
  aks_administrators_group_id              = local.aks_administrators_group_id
  pipelineURI                              = var.pipelineURI
  ingress_application_gateway_name         = local.ingress_application_gateway_name
  ingress_application_gateway_subnet_id    = module.vnet.appgw_subnet_id
  tags                                     = local.default_tags
  depends_on = [module.vnet, module.acr]
}
